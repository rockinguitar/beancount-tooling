services:
  beancount:
    image: fava-local
    build:
      context: .
      dockerfile: Dockerfile
    container_name: beancount
    ports:
      - "5001:5000"
    volumes:
      - ./:/ledger:ro
    environment:
      BEANCOUNT_FILE: /ledger/main.beancount
    command: >
      sh -lc 'fava -H 0.0.0.0 -p 5000 "$$BEANCOUNT_FILE"'
    restart: unless-stopped

  beancheck:
    image: fava-local
    build:
      context: .
      dockerfile: Dockerfile
    container_name: beancheck
    volumes:
      - ./:/ledger:ro
    environment:
      BEANCOUNT_FILE: /ledger/main.beancount
    entrypoint: sh
    command: -lc 'bean-check "$$BEANCOUNT_FILE"'
    profiles: ["tools"]

  csv2xlsx:
    image: python:3.14-slim
    volumes:
      - ./:/work
    working_dir: /work
    entrypoint: sh
    command: -lc 'pip install --no-cache-dir pandas openpyxl && python scripts/csv_to_xlsx_pandas.py'
    profiles: ["tools"]